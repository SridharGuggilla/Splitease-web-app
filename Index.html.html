<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SplitEase â€” Split expenses effortlessly</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d1117;
    --surface: #161b22;
    --surface2: #1e2530;
    --border: #30363d;
    --accent: #00d4aa;
    --accent2: #ff6b6b;
    --accent3: #ffd93d;
    --text: #e6edf3;
    --muted: #8b949e;
    --green: #3fb950;
    --red: #f85149;
    --purple: #bc8cff;
    --radius: 16px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Sora', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen { display: none; min-height: 100vh; }
  .screen.active { display: flex; flex-direction: column; }

  /* â”€â”€ AUTH â”€â”€ */
  #auth-screen {
    background: linear-gradient(135deg, #0d1117 0%, #0a1628 50%, #0d1117 100%);
    align-items: center; justify-content: center; padding: 24px;
    position: relative; overflow: hidden;
  }
  #auth-screen::before {
    content: ''; position: absolute; width: 600px; height: 600px; border-radius: 50%;
    background: radial-gradient(circle, rgba(0,212,170,0.08) 0%, transparent 70%);
    top: -100px; right: -100px; pointer-events: none;
  }
  #auth-screen::after {
    content: ''; position: absolute; width: 400px; height: 400px; border-radius: 50%;
    background: radial-gradient(circle, rgba(188,140,255,0.06) 0%, transparent 70%);
    bottom: -50px; left: -50px; pointer-events: none;
  }
  .auth-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 24px; padding: 48px 40px; width: 100%; max-width: 420px;
    position: relative; z-index: 1;
    box-shadow: 0 25px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(0,212,170,0.05);
    animation: slideUp 0.5s ease;
  }
  @keyframes slideUp { from { opacity:0; transform:translateY(30px) } to { opacity:1; transform:translateY(0) } }
  .logo { display: flex; align-items: center; gap: 10px; margin-bottom: 32px; }
  .logo-icon {
    width: 40px; height: 40px; border-radius: 12px;
    background: linear-gradient(135deg, var(--accent), var(--purple));
    display: flex; align-items: center; justify-content: center; font-size: 18px;
  }
  .logo-text { font-size: 22px; font-weight: 700; }
  .logo-text span { color: var(--accent); }
  h2 { font-size: 24px; font-weight: 600; margin-bottom: 8px; }
  .subtitle { color: var(--muted); font-size: 14px; margin-bottom: 28px; }
  .form-group { margin-bottom: 18px; }
  label { display: block; font-size: 13px; font-weight: 500; color: var(--muted); margin-bottom: 8px; }
  input[type="email"], input[type="password"], input[type="text"], input[type="number"], select, textarea {
    width: 100%; padding: 13px 16px; background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; color: var(--text); font-family: inherit; font-size: 14px; outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  input:focus, select:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,212,170,0.1); }
  .btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 13px 20px; border-radius: 12px; border: none; cursor: pointer;
    font-family: inherit; font-size: 14px; font-weight: 600; transition: all 0.2s; text-decoration: none;
  }
  .btn-primary { background: var(--accent); color: #0d1117; width: 100%; }
  .btn-primary:hover { background: #00bfa0; transform: translateY(-1px); box-shadow: 0 8px 25px rgba(0,212,170,0.3); }
  .btn-ghost { background: transparent; color: var(--text); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--accent); color: var(--accent); }
  .btn-danger { background: rgba(248,81,73,0.15); color: var(--red); border: 1px solid rgba(248,81,73,0.3); }
  .btn-danger:hover { background: rgba(248,81,73,0.25); }
  .btn-sm { padding: 8px 14px; font-size: 13px; border-radius: 10px; }
  .auth-toggle { text-align: center; margin-top: 20px; font-size: 13px; color: var(--muted); }
  .auth-toggle a { color: var(--accent); cursor: pointer; text-decoration: none; font-weight: 500; }

  /* â”€â”€ MAIN APP â”€â”€ */
  #app-screen { flex-direction: column; }
  .topbar {
    background: var(--surface); border-bottom: 1px solid var(--border);
    padding: 0 20px; height: 64px; display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 100;
  }
  .topbar-logo { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 700; }
  .topbar-logo span { color: var(--accent); }
  .topbar-logo .logo-icon { width: 32px; height: 32px; font-size: 14px; border-radius: 8px; }
  .user-menu { display: flex; align-items: center; gap: 12px; }
  .avatar {
    width: 36px; height: 36px; border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--purple));
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 700; color: #0d1117; cursor: pointer;
  }

  .app-body { display: flex; flex: 1; overflow: hidden; }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar {
    width: 280px; background: var(--surface); border-right: 1px solid var(--border);
    padding: 20px 12px; display: flex; flex-direction: column; gap: 4px;
    overflow-y: auto; flex-shrink: 0;
  }
  .sidebar-section-title { font-size: 11px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.8px; padding: 8px 12px 4px; }
  .sidebar-item {
    display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 10px;
    cursor: pointer; transition: all 0.15s; font-size: 14px; color: var(--muted); font-weight: 500;
    position: relative;
  }
  .sidebar-item:hover { background: var(--surface2); color: var(--text); }
  .sidebar-item.active { background: rgba(0,212,170,0.1); color: var(--accent); }
  .sidebar-item .item-icon { font-size: 16px; width: 20px; text-align: center; }
  .sidebar-item .badge { margin-left: auto; background: var(--accent2); color: white; border-radius: 10px; padding: 2px 7px; font-size: 11px; font-weight: 700; }
  .group-color { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .sidebar-item .exit-btn {
    margin-left: auto; display: none; background: none; border: none; color: var(--red);
    cursor: pointer; font-size: 14px; padding: 2px 4px; border-radius: 4px;
  }
  .sidebar-item:hover .exit-btn { display: inline; }

  /* â”€â”€ MAIN CONTENT â”€â”€ */
  .main-content { flex: 1; overflow-y: auto; padding: 28px; }

  /* â”€â”€ DASHBOARD â”€â”€ */
  .page { display: none; }
  .page.active { display: block; }
  .page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
  .page-title { font-size: 22px; font-weight: 700; }
  .page-subtitle { color: var(--muted); font-size: 14px; margin-top: 2px; }

  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 28px; }
  .stat-card {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 20px; transition: transform 0.2s;
  }
  .stat-card:hover { transform: translateY(-2px); }
  .stat-label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
  .stat-value { font-size: 28px; font-weight: 700; font-family: 'Space Mono', monospace; }
  .stat-value.green { color: var(--green); }
  .stat-value.red { color: var(--red); }
  .stat-value.accent { color: var(--accent); }
  .stat-change { font-size: 12px; margin-top: 4px; }

  .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
  .section-title { font-size: 15px; font-weight: 600; }

  /* â”€â”€ EXPENSE LIST â”€â”€ */
  .expense-list { display: flex; flex-direction: column; gap: 8px; }
  .expense-item {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 16px 18px; display: flex; align-items: center; gap: 14px;
    transition: border-color 0.2s, transform 0.15s; cursor: pointer;
  }
  .expense-item:hover { border-color: var(--accent); transform: translateX(2px); }
  .expense-icon {
    width: 42px; height: 42px; border-radius: 12px; display: flex; align-items: center;
    justify-content: center; font-size: 18px; flex-shrink: 0;
  }
  .expense-info { flex: 1; min-width: 0; }
  .expense-desc { font-weight: 500; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .expense-meta { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .expense-amount { text-align: right; flex-shrink: 0; }
  .expense-total { font-weight: 700; font-size: 15px; font-family: 'Space Mono', monospace; }
  .expense-share { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .expense-share.you-owe { color: var(--red); }
  .expense-share.owed-to { color: var(--green); }
  .expense-share.settled { color: var(--muted); }

  /* â”€â”€ MODAL â”€â”€ */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000;
    display: flex; align-items: center; justify-content: center; padding: 20px;
    backdrop-filter: blur(4px); opacity: 0; pointer-events: none; transition: opacity 0.2s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: var(--surface); border: 1px solid var(--border); border-radius: 24px;
    padding: 32px; width: 100%; max-width: 480px;
    transform: translateY(20px); transition: transform 0.2s;
    max-height: 90vh; overflow-y: auto;
  }
  .modal-overlay.open .modal { transform: translateY(0); }
  .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
  .modal-title { font-size: 18px; font-weight: 700; }
  .close-btn { background: var(--surface2); border: none; color: var(--muted); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
  .close-btn:hover { color: var(--text); }
  .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .split-options { display: flex; gap: 8px; margin-bottom: 16px; }
  .split-option { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: transparent; color: var(--muted); cursor: pointer; font-family: inherit; font-size: 12px; font-weight: 600; text-align: center; transition: all 0.15s; }
  .split-option.active { border-color: var(--accent); color: var(--accent); background: rgba(0,212,170,0.08); }

  /* â”€â”€ BALANCES â”€â”€ */
  .balance-list { display: flex; flex-direction: column; gap: 10px; }
  .balance-item {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 16px 18px; display: flex; align-items: center; gap: 14px;
  }
  .balance-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0; }
  .balance-info { flex: 1; }
  .balance-name { font-weight: 500; font-size: 14px; }
  .balance-status { font-size: 12px; margin-top: 2px; }
  .balance-amount { font-family: 'Space Mono', monospace; font-weight: 700; font-size: 16px; }
  .settle-btn { background: rgba(63,185,80,0.15); color: var(--green); border: 1px solid rgba(63,185,80,0.3); padding: 7px 14px; border-radius: 8px; cursor: pointer; font-family: inherit; font-size: 12px; font-weight: 600; transition: all 0.15s; }
  .settle-btn:hover { background: rgba(63,185,80,0.25); }

  /* â”€â”€ GROUP CARD â”€â”€ */
  .groups-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 16px; }
  .group-card {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 20px; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
  }
  .group-card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
  .group-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
  .group-card.teal::before { background: linear-gradient(90deg, var(--accent), var(--purple)); }
  .group-card.red::before { background: linear-gradient(90deg, var(--red), var(--accent3)); }
  .group-card.purple::before { background: linear-gradient(90deg, var(--purple), var(--accent)); }
  .group-card.yellow::before { background: linear-gradient(90deg, var(--accent3), var(--green)); }
  .group-icon { font-size: 28px; margin-bottom: 10px; }
  .group-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; }
  .group-members { font-size: 12px; color: var(--muted); margin-bottom: 14px; }
  .group-balance { font-family: 'Space Mono', monospace; font-weight: 700; font-size: 18px; }
  .group-card-actions { display: flex; gap: 8px; margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--border); }

  /* â”€â”€ ACTIVITY â”€â”€ */
  .activity-list { display: flex; flex-direction: column; }
  .activity-item { display: flex; align-items: flex-start; gap: 12px; padding: 14px 0; border-bottom: 1px solid var(--border); }
  .activity-item:last-child { border-bottom: none; }
  .activity-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
  .activity-text { font-size: 13px; line-height: 1.5; }
  .activity-text strong { color: var(--text); }
  .activity-time { font-size: 11px; color: var(--muted); margin-top: 2px; }

  /* â”€â”€ TOAST â”€â”€ */
  #toast {
    position: fixed; bottom: 24px; right: 24px; z-index: 9999;
    background: var(--surface2); border: 1px solid var(--border); border-radius: 12px;
    padding: 14px 18px; font-size: 14px; display: flex; align-items: center; gap: 10px;
    transform: translateY(100px); opacity: 0; transition: all 0.3s;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  }
  #toast.show { transform: translateY(0); opacity: 1; }

  /* â”€â”€ EMPTY STATE â”€â”€ */
  .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); }
  .empty-state .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
  .empty-state h3 { font-size: 18px; color: var(--text); margin-bottom: 8px; }
  .empty-state p { font-size: 14px; max-width: 300px; margin: 0 auto; }

  /* â”€â”€ TABS â”€â”€ */
  .tabs { display: flex; gap: 4px; background: var(--surface2); padding: 4px; border-radius: 12px; margin-bottom: 20px; }
  .tab { flex: 1; padding: 9px; border-radius: 9px; border: none; background: transparent; color: var(--muted); font-family: inherit; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.15s; }
  .tab.active { background: var(--surface); color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }

  /* â”€â”€ CHART â”€â”€ */
  .mini-chart { display: flex; align-items: flex-end; gap: 4px; height: 60px; margin-top: 12px; }
  .chart-bar { flex: 1; border-radius: 4px 4px 0 0; min-height: 4px; transition: height 0.5s ease; cursor: pointer; }
  .chart-bar:hover { opacity: 0.8; }

  /* â”€â”€ PROFILE â”€â”€ */
  .profile-section { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; margin-bottom: 16px; }
  .profile-top { display: flex; align-items: center; gap: 20px; margin-bottom: 24px; }
  .profile-avatar { width: 72px; height: 72px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--purple)); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; color: #0d1117; }
  .profile-name { font-size: 20px; font-weight: 700; }
  .profile-email { font-size: 13px; color: var(--muted); margin-top: 2px; }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media(max-width: 768px) {
    .sidebar { display: none; }
    .main-content { padding: 16px; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .groups-grid { grid-template-columns: 1fr; }
  }

  /* â”€â”€ NOTIFICATION BADGE â”€â”€ */
  .notif-dot { width: 8px; height: 8px; background: var(--red); border-radius: 50%; position: absolute; top: 8px; right: 8px; }
  .member-tag { display: inline-flex; align-items: center; gap: 6px; background: var(--surface2); border: 1px solid var(--border); border-radius: 20px; padding: 5px 10px; font-size: 12px; margin: 3px; }
  .member-tag .remove { cursor: pointer; color: var(--muted); }
  .members-input-area { border: 1px solid var(--border); border-radius: 12px; padding: 10px; min-height: 48px; display: flex; flex-wrap: wrap; align-items: center; gap: 4px; cursor: text; }
  .members-input-area input { border: none; background: transparent; color: var(--text); font-family: inherit; font-size: 14px; outline: none; flex: 1; min-width: 100px; }

  select option { background: var(--surface2); }
  textarea { resize: vertical; min-height: 70px; }
</style>
</head>
<body>

<!-- AUTH SCREEN -->
<div id="auth-screen" class="screen active">
  <div class="auth-card">
    <div class="logo">
      <div class="logo-icon">âœ‚ï¸</div>
      <div class="logo-text">Split<span>Ease</span></div>
    </div>
    <div id="login-form">
      <h2>Welcome back</h2>
      <p class="subtitle">Sign in to manage your expenses</p>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="login-email" placeholder="you@example.com" value="demo@splitease.app">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="password">
      </div>
      <button class="btn btn-primary" onclick="login()">Sign In â†’</button>
      <div class="auth-toggle">Don't have an account? <a onclick="toggleAuth(true)">Create one</a></div>
    </div>
    <div id="register-form" style="display:none">
      <h2>Create account</h2>
      <p class="subtitle">Start splitting expenses with friends</p>
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="reg-name" placeholder="Reena Mehra">
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="reg-email" placeholder="you@example.com">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="reg-password" placeholder="Min 8 characters">
      </div>
      <button class="btn btn-primary" onclick="register()">Create Account â†’</button>
      <div class="auth-toggle">Already have an account? <a onclick="toggleAuth(false)">Sign in</a></div>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="app-screen" class="screen">
  <div class="topbar">
    <div class="topbar-logo">
      <div class="logo-icon">âœ‚ï¸</div>
      Split<span>Ease</span>
    </div>
    <div class="user-menu">
      <button class="btn btn-sm btn-primary" onclick="openModal('add-expense-modal')">+ Add Expense</button>
      <div class="avatar" id="user-avatar" onclick="navigateTo('profile')">RM</div>
    </div>
  </div>

  <div class="app-body">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="sidebar-section-title">Menu</div>
      <div class="sidebar-item active" onclick="navigateTo('dashboard')">
        <span class="item-icon">ğŸ“Š</span> Dashboard
      </div>
      <div class="sidebar-item" onclick="navigateTo('groups')">
        <span class="item-icon">ğŸ‘¥</span> Groups
      </div>
      <div class="sidebar-item" onclick="navigateTo('expenses')">
        <span class="item-icon">ğŸ’¸</span> All Expenses
      </div>
      <div class="sidebar-item" onclick="navigateTo('balances')">
        <span class="item-icon">âš–ï¸</span> Balances
        <span class="badge" id="owe-badge">3</span>
      </div>
      <div class="sidebar-item" onclick="navigateTo('activity')">
        <span class="item-icon">ğŸ””</span> Activity
      </div>
      <div style="margin-top: 8px;">
        <div class="sidebar-section-title">My Groups</div>
        <div id="sidebar-groups"></div>
      </div>
      <div style="margin-top: auto;">
        <div class="sidebar-item" onclick="navigateTo('profile')">
          <span class="item-icon">ğŸ‘¤</span> Profile
        </div>
        <div class="sidebar-item" onclick="logout()" style="color: var(--red)">
          <span class="item-icon">ğŸšª</span> Logout
        </div>
      </div>
    </div>

    <!-- CONTENT -->
    <div class="main-content">

      <!-- DASHBOARD -->
      <div id="page-dashboard" class="page active">
        <div class="page-header">
          <div>
            <div class="page-title" id="welcome-msg">Good morning, Reena ğŸ‘‹</div>
            <div class="page-subtitle">Here's your expense summary</div>
          </div>
          <button class="btn btn-ghost btn-sm" onclick="openModal('add-group-modal')">+ New Group</button>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total Owed to You</div>
            <div class="stat-value green" id="stat-owed">$0.00</div>
            <div class="stat-change" style="color:var(--green)">â†‘ across all groups</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">You Owe</div>
            <div class="stat-value red" id="stat-owe">$0.00</div>
            <div class="stat-change" style="color:var(--red)">â†“ settle up</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Spent</div>
            <div class="stat-value accent" id="stat-spent">$0.00</div>
            <div class="stat-change" style="color:var(--muted)">this month</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Groups</div>
            <div class="stat-value" id="stat-groups">0</div>
            <div class="stat-change" style="color:var(--muted)">active</div>
          </div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:24px;">
          <div class="stat-card">
            <div class="section-header">
              <div class="section-title">Spending This Month</div>
            </div>
            <div class="mini-chart" id="spend-chart"></div>
            <div style="display:flex; justify-content:space-between; margin-top:6px; font-size:11px; color:var(--muted)">
              <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
            </div>
          </div>
          <div class="stat-card">
            <div class="section-title" style="margin-bottom:14px">Quick Actions</div>
            <div style="display:flex; flex-direction:column; gap:8px;">
              <button class="btn btn-ghost" onclick="openModal('add-expense-modal')" style="width:100%; justify-content:flex-start; gap:10px;">ğŸ’¸ Add New Expense</button>
              <button class="btn btn-ghost" onclick="openModal('add-group-modal')" style="width:100%; justify-content:flex-start; gap:10px;">ğŸ‘¥ Create Group</button>
              <button class="btn btn-ghost" onclick="navigateTo('balances')" style="width:100%; justify-content:flex-start; gap:10px;">âš–ï¸ Settle Up</button>
              <button class="btn btn-ghost" onclick="exportData()" style="width:100%; justify-content:flex-start; gap:10px;">ğŸ“¤ Export CSV</button>
            </div>
          </div>
        </div>
        <div class="section-header">
          <div class="section-title">Recent Expenses</div>
          <a onclick="navigateTo('expenses')" style="font-size:13px; color:var(--accent); cursor:pointer">View all â†’</a>
        </div>
        <div class="expense-list" id="recent-expenses"></div>
      </div>

      <!-- GROUPS -->
      <div id="page-groups" class="page">
        <div class="page-header">
          <div>
            <div class="page-title">Groups</div>
            <div class="page-subtitle">Manage your expense groups</div>
          </div>
          <button class="btn btn-primary btn-sm" onclick="openModal('add-group-modal')">+ New Group</button>
        </div>
        <div class="groups-grid" id="groups-grid"></div>
      </div>

      <!-- EXPENSES -->
      <div id="page-expenses" class="page">
        <div class="page-header">
          <div>
            <div class="page-title">All Expenses</div>
            <div class="page-subtitle" id="expenses-subtitle">Showing all transactions</div>
          </div>
          <button class="btn btn-primary btn-sm" onclick="openModal('add-expense-modal')">+ Add Expense</button>
        </div>
        <div class="tabs" id="expense-tabs">
          <button class="tab active" onclick="filterExpenses('all')">All</button>
          <button class="tab" onclick="filterExpenses('owe')">I Owe</button>
          <button class="tab" onclick="filterExpenses('owed')">Owed to Me</button>
          <button class="tab" onclick="filterExpenses('settled')">Settled</button>
        </div>
        <div class="expense-list" id="all-expenses"></div>
      </div>

      <!-- BALANCES -->
      <div id="page-balances" class="page">
        <div class="page-header">
          <div>
            <div class="page-title">Balances</div>
            <div class="page-subtitle">Who owes what</div>
          </div>
        </div>
        <div class="balance-list" id="balances-list"></div>
      </div>

      <!-- ACTIVITY -->
      <div id="page-activity" class="page">
        <div class="page-header">
          <div class="page-title">Activity</div>
        </div>
        <div class="stat-card">
          <div class="activity-list" id="activity-list"></div>
        </div>
      </div>

      <!-- PROFILE -->
      <div id="page-profile" class="page">
        <div class="page-title" style="margin-bottom:20px">Profile</div>
        <div class="profile-section">
          <div class="profile-top">
            <div class="profile-avatar" id="profile-avatar">RM</div>
            <div>
              <div class="profile-name" id="profile-name">Reena Mehra</div>
              <div class="profile-email" id="profile-email">demo@splitease.app</div>
            </div>
          </div>
          <div class="row-2">
            <div class="form-group">
              <label>Display Name</label>
              <input type="text" id="profile-name-input" placeholder="Your name">
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="profile-email-input" placeholder="Email">
            </div>
          </div>
          <div class="form-group">
            <label>Currency</label>
            <select id="profile-currency">
              <option value="USD">ğŸ‡ºğŸ‡¸ USD â€” US Dollar</option>
              <option value="GBP">ğŸ‡¬ğŸ‡§ GBP â€” British Pound</option>
              <option value="EUR">ğŸ‡ªğŸ‡º EUR â€” Euro</option>
              <option value="INR">ğŸ‡®ğŸ‡³ INR â€” Indian Rupee</option>
            </select>
          </div>
          <button class="btn btn-primary" onclick="saveProfile()" style="width:auto; padding: 11px 24px;">Save Changes</button>
        </div>
        <div class="profile-section">
          <div class="section-title" style="margin-bottom:14px">Danger Zone</div>
          <p style="font-size:13px; color:var(--muted); margin-bottom:14px">Permanently delete your account and all associated data.</p>
          <button class="btn btn-danger btn-sm">Delete Account</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ MODALS â”€â”€ -->

<!-- Add Expense Modal -->
<div class="modal-overlay" id="add-expense-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Add Expense</div>
      <button class="close-btn" onclick="closeModal('add-expense-modal')">âœ•</button>
    </div>
    <div class="form-group">
      <label>Description</label>
      <input type="text" id="exp-desc" placeholder="e.g. Dinner at Sushi Place">
    </div>
    <div class="row-2">
      <div class="form-group">
        <label>Amount ($)</label>
        <input type="number" id="exp-amount" placeholder="0.00" step="0.01">
      </div>
      <div class="form-group">
        <label>Category</label>
        <select id="exp-category">
          <option value="ğŸ• Food">ğŸ• Food</option>
          <option value="ğŸš— Transport">ğŸš— Transport</option>
          <option value="ğŸ  Housing">ğŸ  Housing</option>
          <option value="ğŸ‰ Entertainment">ğŸ‰ Entertainment</option>
          <option value="ğŸ› Shopping">ğŸ› Shopping</option>
          <option value="ğŸ¥ Health">ğŸ¥ Health</option>
          <option value="âœˆï¸ Travel">âœˆï¸ Travel</option>
          <option value="ğŸ“¦ Other">ğŸ“¦ Other</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label>Group</label>
      <select id="exp-group"></select>
    </div>
    <div class="form-group">
      <label>Paid by</label>
      <select id="exp-paidby"></select>
    </div>
    <div class="form-group">
      <label>Split Method</label>
      <div class="split-options">
        <button class="split-option active" onclick="setSplit('equal')">âš–ï¸ Equal</button>
        <button class="split-option" onclick="setSplit('exact')">ğŸ’¯ Exact</button>
        <button class="split-option" onclick="setSplit('percent')">ğŸ“Š %</button>
      </div>
    </div>
    <div class="form-group">
      <label>Notes (optional)</label>
      <textarea id="exp-notes" placeholder="Any additional details..."></textarea>
    </div>
    <button class="btn btn-primary" onclick="addExpense()">Add Expense</button>
  </div>
</div>

<!-- Add Group Modal -->
<div class="modal-overlay" id="add-group-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Create Group</div>
      <button class="close-btn" onclick="closeModal('add-group-modal')">âœ•</button>
    </div>
    <div class="form-group">
      <label>Group Name</label>
      <input type="text" id="grp-name" placeholder="e.g. NYC Trip 2025">
    </div>
    <div class="form-group">
      <label>Category</label>
      <select id="grp-type">
        <option>âœˆï¸ Trip</option>
        <option>ğŸ  Home</option>
        <option>ğŸ’¼ Work</option>
        <option>ğŸ‰ Event</option>
        <option>ğŸ‘¥ General</option>
      </select>
    </div>
    <div class="form-group">
      <label>Add Members (press Enter)</label>
      <div class="members-input-area" id="members-area" onclick="document.getElementById('member-input').focus()">
        <input type="text" id="member-input" placeholder="Type name and press Enter" onkeydown="handleMemberInput(event)">
      </div>
    </div>
    <div class="form-group">
      <label>Color Theme</label>
      <div style="display:flex; gap:8px;">
        <div onclick="selectColor('teal')" style="width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#00d4aa,#bc8cff);cursor:pointer;border:2px solid transparent;" id="color-teal"></div>
        <div onclick="selectColor('red')" style="width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#f85149,#ffd93d);cursor:pointer;border:2px solid transparent;" id="color-red"></div>
        <div onclick="selectColor('purple')" style="width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#bc8cff,#00d4aa);cursor:pointer;border:2px solid transparent;" id="color-purple"></div>
        <div onclick="selectColor('yellow')" style="width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#ffd93d,#3fb950);cursor:pointer;border:2px solid transparent;" id="color-yellow"></div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="addGroup()">Create Group</button>
  </div>
</div>

<!-- Settle Modal -->
<div class="modal-overlay" id="settle-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Settle Up</div>
      <button class="close-btn" onclick="closeModal('settle-modal')">âœ•</button>
    </div>
    <div id="settle-content"></div>
    <button class="btn btn-primary" style="background:var(--green); margin-top:16px;" onclick="confirmSettle()">âœ“ Mark as Settled</button>
  </div>
</div>

<!-- Exit Group Confirm -->
<div class="modal-overlay" id="exit-group-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Exit Group</div>
      <button class="close-btn" onclick="closeModal('exit-group-modal')">âœ•</button>
    </div>
    <p style="color:var(--muted); font-size:14px; line-height:1.6; margin-bottom:20px;">Are you sure you want to leave <strong id="exit-group-name" style="color:var(--text)"></strong>? Any unsettled balances should be resolved first.</p>
    <div style="display:flex; gap:10px;">
      <button class="btn btn-ghost" onclick="closeModal('exit-group-modal')" style="flex:1">Cancel</button>
      <button class="btn btn-danger" onclick="confirmExitGroup()" style="flex:1">Leave Group</button>
    </div>
  </div>
</div>

<div id="toast">ğŸ‰ <span id="toast-msg"></span></div>

<script>
// â”€â”€ STATE â”€â”€
let state = {
  user: null,
  groups: [
    { id: 1, name: 'NYC Trip 2023', type: 'âœˆï¸ Trip', color: 'teal', members: ['Reena M.', 'Alex K.', 'Sam T.'], balance: 42.38 },
    { id: 2, name: 'Apartment', type: 'ğŸ  Home', color: 'purple', members: ['Reena M.', 'Jordan L.'], balance: -23.50 },
    { id: 3, name: 'Office Lunches', type: 'ğŸ’¼ Work', color: 'yellow', members: ['Reena M.', 'Chris P.', 'Taylor W.', 'Morgan R.'], balance: 15.00 },
  ],
  expenses: [
    { id: 1, desc: 'NYC Trip 2023', category: 'âœˆï¸ Travel', amount: 243.57, paidBy: 'Reena M.', group: 1, date: '2023-02-17', share: 'owed', shareAmt: 42.38, settled: false, notes: '' },
    { id: 2, desc: 'Groceries', category: 'ğŸ› Shopping', amount: 51.96, paidBy: 'Alex K.', group: 1, date: '2023-02-19', share: 'owe', shareAmt: 12.99, settled: false, notes: '' },
    { id: 3, desc: 'Metro ticket', category: 'ğŸš— Transport', amount: 47.30, paidBy: 'Reena M.', group: 1, date: '2023-02-07', share: 'owed', shareAmt: 10.38, settled: false, notes: '' },
    { id: 4, desc: 'Chinese Restaurant', category: 'ğŸ• Food', amount: 89.22, paidBy: 'Sam T.', group: 1, date: '2023-01-30', share: 'owe', shareAmt: 9.22, settled: false, notes: '' },
    { id: 5, desc: 'Monthly Rent Share', category: 'ğŸ  Housing', amount: 800, paidBy: 'Jordan L.', group: 2, date: '2024-02-01', share: 'owe', shareAmt: 400, settled: true, notes: '' },
  ],
  balances: [
    { person: 'Alex K.', amount: -12.99, initials: 'AK', color: '#bc8cff' },
    { person: 'Sam T.', amount: 42.38, initials: 'ST', color: '#00d4aa' },
    { person: 'Jordan L.', amount: -23.50, initials: 'JL', color: '#ff6b6b' },
    { person: 'Chris P.', amount: 15.00, initials: 'CP', color: '#ffd93d' },
  ],
  activity: [
    { text: '<strong>Alex K.</strong> added <strong>Groceries</strong> â€” $51.96', time: '2 hours ago', color: '#00d4aa' },
    { text: 'You settled up with <strong>Jordan L.</strong> â€” $400.00', time: 'Yesterday', color: '#3fb950' },
    { text: '<strong>Sam T.</strong> added <strong>Chinese Restaurant</strong> â€” $89.22', time: '3 days ago', color: '#bc8cff' },
    { text: 'You added <strong>NYC Trip 2023</strong> â€” $243.57', time: '5 days ago', color: '#ffd93d' },
    { text: '<strong>Chris P.</strong> joined Office Lunches', time: '1 week ago', color: '#ff6b6b' },
  ],
  pendingMembers: [],
  selectedColor: 'teal',
  selectedSplit: 'equal',
  pendingSettle: null,
  exitGroupId: null,
  currentFilter: 'all',
  currentPage: 'dashboard',
};

// â”€â”€ AUTH â”€â”€
function toggleAuth(showRegister) {
  document.getElementById('login-form').style.display = showRegister ? 'none' : 'block';
  document.getElementById('register-form').style.display = showRegister ? 'block' : 'none';
}
function login() {
  const email = document.getElementById('login-email').value.trim();
  const pass = document.getElementById('login-password').value;
  if (!email || !pass) return showToast('âš ï¸ Please fill in all fields');
  state.user = { name: email.split('@')[0].replace(/\./g,' ').replace(/\b\w/g,c=>c.toUpperCase()), email, initials: email.substring(0,2).toUpperCase() };
  initApp();
}
function register() {
  const name = document.getElementById('reg-name').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  const pass = document.getElementById('reg-password').value;
  if (!name || !email || !pass) return showToast('âš ï¸ Please fill in all fields');
  if (pass.length < 8) return showToast('âš ï¸ Password must be 8+ characters');
  state.user = { name, email, initials: name.split(' ').map(n=>n[0]).join('').toUpperCase().substring(0,2) };
  initApp();
}
function logout() {
  document.getElementById('auth-screen').classList.add('active');
  document.getElementById('app-screen').classList.remove('active');
  showToast('ğŸ‘‹ Logged out successfully');
}
function initApp() {
  document.getElementById('auth-screen').classList.remove('active');
  document.getElementById('app-screen').classList.add('active');
  const u = state.user;
  const h = new Date().getHours();
  const greeting = h < 12 ? 'morning' : h < 18 ? 'afternoon' : 'evening';
  document.getElementById('welcome-msg').textContent = `Good ${greeting}, ${u.name.split(' ')[0]} ğŸ‘‹`;
  document.getElementById('user-avatar').textContent = u.initials;
  document.getElementById('profile-avatar').textContent = u.initials;
  document.getElementById('profile-name').textContent = u.name;
  document.getElementById('profile-email').textContent = u.email;
  document.getElementById('profile-name-input').value = u.name;
  document.getElementById('profile-email-input').value = u.email;
  renderAll();
}

// â”€â”€ NAVIGATION â”€â”€
function navigateTo(page) {
  state.currentPage = page;
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
  document.getElementById(`page-${page}`).classList.add('active');
  document.querySelectorAll('.sidebar-item').forEach(i => {
    if(i.getAttribute('onclick') && i.getAttribute('onclick').includes(page)) i.classList.add('active');
  });
  if(page==='expenses') renderExpenses();
  if(page==='groups') renderGroups();
  if(page==='balances') renderBalances();
  if(page==='activity') renderActivity();
}

// â”€â”€ RENDER ALL â”€â”€
function renderAll() {
  renderStats();
  renderRecentExpenses();
  renderSidebarGroups();
  renderGroups();
  renderExpenses();
  renderBalances();
  renderActivity();
  renderSpendChart();
  populateExpenseForm();
}

function renderStats() {
  const owed = state.balances.filter(b=>b.amount>0).reduce((s,b)=>s+b.amount,0);
  const owe = Math.abs(state.balances.filter(b=>b.amount<0).reduce((s,b)=>s+b.amount,0));
  const spent = state.expenses.reduce((s,e)=>s+e.amount,0);
  document.getElementById('stat-owed').textContent = `$${owed.toFixed(2)}`;
  document.getElementById('stat-owe').textContent = `$${owe.toFixed(2)}`;
  document.getElementById('stat-spent').textContent = `$${spent.toFixed(2)}`;
  document.getElementById('stat-groups').textContent = state.groups.length;
  document.getElementById('owe-badge').textContent = state.balances.filter(b=>b.amount<0).length;
}

function renderSpendChart() {
  const vals = [35,80,20,95,55,70,45];
  const max = Math.max(...vals);
  const colors = ['#00d4aa','#bc8cff','#ffd93d','#ff6b6b','#3fb950','#00d4aa','#bc8cff'];
  document.getElementById('spend-chart').innerHTML = vals.map((v,i)=>
    `<div class="chart-bar" style="height:${(v/max)*100}%;background:${colors[i]};opacity:0.7;" title="$${v}"></div>`
  ).join('');
}

function renderRecentExpenses() {
  const el = document.getElementById('recent-expenses');
  const recent = [...state.expenses].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,4);
  el.innerHTML = recent.length ? recent.map(e=>expenseHTML(e)).join('') : emptyState('ğŸ’¸','No expenses yet','Add your first expense to get started');
}

function expenseHTML(e) {
  const cats = {'ğŸ• Food':'ğŸ•','ğŸš— Transport':'ğŸš—','ğŸ  Housing':'ğŸ ','ğŸ‰ Entertainment':'ğŸ‰','ğŸ› Shopping':'ğŸ›','ğŸ¥ Health':'ğŸ¥','âœˆï¸ Travel':'âœˆï¸','ğŸ“¦ Other':'ğŸ“¦'};
  const icon = cats[e.category] || 'ğŸ“¦';
  const bgMap = {'ğŸ•':'rgba(255,107,107,0.15)','ğŸš—':'rgba(0,212,170,0.15)','ğŸ ':'rgba(63,185,80,0.15)','ğŸ‰':'rgba(255,217,61,0.15)','ğŸ›':'rgba(188,140,255,0.15)','ğŸ¥':'rgba(255,107,107,0.15)','âœˆï¸':'rgba(0,212,170,0.15)','ğŸ“¦':'rgba(139,148,158,0.15)'};
  const shareClass = e.settled ? 'settled' : e.share === 'owe' ? 'you-owe' : 'owed-to';
  const shareText = e.settled ? 'Settled' : e.share === 'owe' ? `You owe $${e.shareAmt.toFixed(2)}` : `You lent $${e.shareAmt.toFixed(2)}`;
  return `<div class="expense-item">
    <div class="expense-icon" style="background:${bgMap[icon]||'rgba(139,148,158,0.15)'}">${icon}</div>
    <div class="expense-info">
      <div class="expense-desc">${e.desc}</div>
      <div class="expense-meta">${e.paidBy} â€¢ ${e.category.split(' ')[1]||''} â€¢ ${formatDate(e.date)}</div>
    </div>
    <div class="expense-amount">
      <div class="expense-total">$${e.amount.toFixed(2)}</div>
      <div class="expense-share ${shareClass}">${shareText}</div>
    </div>
  </div>`;
}

function emptyState(icon, title, msg) {
  return `<div class="empty-state"><div class="empty-icon">${icon}</div><h3>${title}</h3><p>${msg}</p></div>`;
}

function renderSidebarGroups() {
  const colors = {teal:'#00d4aa',red:'#ff6b6b',purple:'#bc8cff',yellow:'#ffd93d'};
  document.getElementById('sidebar-groups').innerHTML = state.groups.map(g=>
    `<div class="sidebar-item" onclick="navigateTo('groups')">
      <div class="group-color" style="background:${colors[g.color]||'#00d4aa'}"></div>
      <span style="flex:1;font-size:13px">${g.name}</span>
      <button class="exit-btn" onclick="event.stopPropagation();promptExitGroup(${g.id})" title="Leave group">âœ•</button>
    </div>`
  ).join('');
}

function renderGroups() {
  document.getElementById('groups-grid').innerHTML = state.groups.length ? state.groups.map(g => `
    <div class="group-card ${g.color}">
      <div class="group-icon">${g.type.split(' ')[0]}</div>
      <div class="group-name">${g.name}</div>
      <div class="group-members">${g.members.length} members â€¢ ${g.members.slice(0,2).join(', ')}${g.members.length>2?'...':''}</div>
      <div class="group-balance" style="color:${g.balance>=0?'var(--green)':'var(--red)'}">${g.balance>=0?'+':''}\$${Math.abs(g.balance).toFixed(2)}</div>
      <div class="group-card-actions">
        <button class="btn btn-ghost btn-sm" onclick="openModal('add-expense-modal')" style="flex:1">+ Expense</button>
        <button class="btn btn-danger btn-sm" onclick="promptExitGroup(${g.id})">Leave</button>
      </div>
    </div>`).join('') : emptyState('ğŸ‘¥','No groups yet','Create a group to start splitting expenses');
}

function renderExpenses() {
  const filter = state.currentFilter;
  let exps = [...state.expenses].sort((a,b)=>new Date(b.date)-new Date(a.date));
  if(filter==='owe') exps = exps.filter(e=>e.share==='owe'&&!e.settled);
  else if(filter==='owed') exps = exps.filter(e=>e.share==='owed'&&!e.settled);
  else if(filter==='settled') exps = exps.filter(e=>e.settled);
  document.getElementById('all-expenses').innerHTML = exps.length ? exps.map(expenseHTML).join('') : emptyState('ğŸ’¸','No expenses','Nothing to show here');
  document.getElementById('expenses-subtitle').textContent = `Showing ${exps.length} transaction${exps.length!==1?'s':''}`;
}

function filterExpenses(f) {
  state.currentFilter = f;
  document.querySelectorAll('#expense-tabs .tab').forEach((t,i)=>{
    t.classList.toggle('active', ['all','owe','owed','settled'][i]===f);
  });
  renderExpenses();
}

function renderBalances() {
  document.getElementById('balances-list').innerHTML = state.balances.map(b=>`
    <div class="balance-item">
      <div class="balance-avatar" style="background:${b.color}22;color:${b.color}">${b.initials}</div>
      <div class="balance-info">
        <div class="balance-name">${b.person}</div>
        <div class="balance-status" style="color:${b.amount>0?'var(--green)':'var(--red)'}">${b.amount>0?'Owes you':'You owe'}</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <div class="balance-amount" style="color:${b.amount>0?'var(--green)':'var(--red)'}">${b.amount>0?'+':''}\$${Math.abs(b.amount).toFixed(2)}</div>
        ${b.amount<0?`<button class="settle-btn" onclick="settleUp('${b.person}',${Math.abs(b.amount)})">Settle Up</button>`:''}
      </div>
    </div>`).join('') || emptyState('âš–ï¸','All settled!','No outstanding balances');
}

function renderActivity() {
  document.getElementById('activity-list').innerHTML = state.activity.map(a=>`
    <div class="activity-item">
      <div class="activity-dot" style="background:${a.color}"></div>
      <div>
        <div class="activity-text">${a.text}</div>
        <div class="activity-time">${a.time}</div>
      </div>
    </div>`).join('');
}

// â”€â”€ EXPENSE FORM â”€â”€
function populateExpenseForm() {
  const gs = document.getElementById('exp-group');
  gs.innerHTML = state.groups.map(g=>`<option value="${g.id}">${g.name}</option>`).join('');
  const pb = document.getElementById('exp-paidby');
  pb.innerHTML = ['You','Alex K.','Sam T.','Jordan L.','Chris P.'].map(n=>`<option>${n}</option>`).join('');
}
function setSplit(type) {
  state.selectedSplit = type;
  document.querySelectorAll('.split-option').forEach((b,i)=>{
    b.classList.toggle('active', ['equal','exact','percent'][i]===type);
  });
}
function addExpense() {
  const desc = document.getElementById('exp-desc').value.trim();
  const amount = parseFloat(document.getElementById('exp-amount').value);
  const category = document.getElementById('exp-category').value;
  const groupId = parseInt(document.getElementById('exp-group').value);
  const paidBy = document.getElementById('exp-paidby').value;
  const notes = document.getElementById('exp-notes').value;
  if(!desc || !amount || amount<=0) return showToast('âš ï¸ Please enter description and valid amount');
  const share = paidBy === 'You' ? 'owed' : 'owe';
  const shareAmt = +(amount / (state.groups.find(g=>g.id===groupId)?.members.length||2)).toFixed(2);
  const exp = { id: Date.now(), desc, category, amount, paidBy, group: groupId, date: new Date().toISOString().split('T')[0], share, shareAmt, settled: false, notes };
  state.expenses.unshift(exp);
  state.activity.unshift({ text: `You added <strong>${desc}</strong> â€” $${amount.toFixed(2)}`, time: 'Just now', color: '#00d4aa' });
  closeModal('add-expense-modal');
  document.getElementById('exp-desc').value=''; document.getElementById('exp-amount').value=''; document.getElementById('exp-notes').value='';
  renderAll();
  showToast('âœ… Expense added successfully!');
}

// â”€â”€ GROUPS â”€â”€
let newGroupMembers = [];
function handleMemberInput(e) {
  if(e.key==='Enter') {
    const val = e.target.value.trim();
    if(!val) return;
    newGroupMembers.push(val);
    const tag = document.createElement('div');
    tag.className='member-tag';
    tag.innerHTML=`${val}<span class="remove" onclick="removeMember(this,'${val}')">âœ•</span>`;
    document.getElementById('members-area').insertBefore(tag, e.target);
    e.target.value='';
  }
}
function removeMember(el, name) {
  newGroupMembers = newGroupMembers.filter(m=>m!==name);
  el.parentElement.remove();
}
function selectColor(c) {
  state.selectedColor = c;
  ['teal','red','purple','yellow'].forEach(col=>{
    document.getElementById(`color-${col}`).style.border = col===c ? '2px solid var(--accent)' : '2px solid transparent';
  });
}
function addGroup() {
  const name = document.getElementById('grp-name').value.trim();
  const type = document.getElementById('grp-type').value;
  if(!name) return showToast('âš ï¸ Please enter a group name');
  const group = { id: Date.now(), name, type, color: state.selectedColor, members: ['You', ...newGroupMembers], balance: 0 };
  state.groups.push(group);
  state.activity.unshift({ text: `You created group <strong>${name}</strong>`, time: 'Just now', color: '#bc8cff' });
  newGroupMembers = [];
  document.getElementById('members-area').querySelectorAll('.member-tag').forEach(t=>t.remove());
  document.getElementById('grp-name').value='';
  closeModal('add-group-modal');
  populateExpenseForm();
  renderAll();
  showToast(`âœ… Group "${name}" created!`);
}

// â”€â”€ EXIT GROUP â”€â”€
function promptExitGroup(id) {
  state.exitGroupId = id;
  const g = state.groups.find(g=>g.id===id);
  document.getElementById('exit-group-name').textContent = g.name;
  openModal('exit-group-modal');
}
function confirmExitGroup() {
  const g = state.groups.find(g=>g.id===state.exitGroupId);
  if(g) {
    state.activity.unshift({ text: `You left <strong>${g.name}</strong>`, time: 'Just now', color: '#f85149' });
    state.groups = state.groups.filter(g=>g.id!==state.exitGroupId);
    state.expenses = state.expenses.filter(e=>e.group!==state.exitGroupId);
    closeModal('exit-group-modal');
    renderAll();
    showToast(`ğŸ‘‹ Left group "${g.name}"`);
  }
}

// â”€â”€ SETTLE â”€â”€
function settleUp(person, amount) {
  state.pendingSettle = { person, amount };
  document.getElementById('settle-content').innerHTML = `
    <div style="background:rgba(63,185,80,0.08);border:1px solid rgba(63,185,80,0.2);border-radius:12px;padding:20px;text-align:center;margin-bottom:16px;">
      <div style="font-size:32px;margin-bottom:8px;">ğŸ’¸</div>
      <div style="font-size:13px;color:var(--muted);margin-bottom:4px;">You owe ${person}</div>
      <div style="font-size:28px;font-weight:700;font-family:'Space Mono',monospace;color:var(--green)">$${amount.toFixed(2)}</div>
    </div>
    <div class="form-group"><label>Payment Method</label>
      <select><option>ğŸ’° Cash</option><option>ğŸ¦ Bank Transfer</option><option>ğŸ“± PayPal</option><option>ğŸ’³ Venmo</option></select>
    </div>
    <div class="form-group"><label>Note (optional)</label><input type="text" placeholder="Add a note..."></div>`;
  openModal('settle-modal');
}
function confirmSettle() {
  if(!state.pendingSettle) return;
  const { person, amount } = state.pendingSettle;
  const b = state.balances.find(b=>b.person===person);
  if(b) b.amount = 0;
  state.activity.unshift({ text: `You settled $${amount.toFixed(2)} with <strong>${person}</strong>`, time: 'Just now', color: '#3fb950' });
  state.balances = state.balances.filter(b=>b.amount!==0);
  closeModal('settle-modal');
  renderAll();
  showToast(`âœ… Settled up with ${person}!`);
}

// â”€â”€ PROFILE â”€â”€
function saveProfile() {
  const name = document.getElementById('profile-name-input').value.trim();
  const email = document.getElementById('profile-email-input').value.trim();
  if(!name||!email) return showToast('âš ï¸ Name and email are required');
  state.user.name = name; state.user.email = email;
  state.user.initials = name.split(' ').map(n=>n[0]).join('').toUpperCase().substring(0,2);
  document.getElementById('profile-name').textContent = name;
  document.getElementById('profile-email').textContent = email;
  document.getElementById('profile-avatar').textContent = state.user.initials;
  document.getElementById('user-avatar').textContent = state.user.initials;
  showToast('âœ… Profile updated!');
}

// â”€â”€ EXPORT â”€â”€
function exportData() {
  const rows = [['Description','Category','Amount','Paid By','Date','Your Share','Status']];
  state.expenses.forEach(e=>rows.push([e.desc,e.category,e.amount,e.paidBy,e.date,e.shareAmt,e.settled?'Settled':e.share==='owe'?'You Owe':'Owed to You']));
  const csv = rows.map(r=>r.join(',')).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = 'splitease-expenses.csv';
  a.click();
  showToast('ğŸ“¤ Expenses exported!');
}

// â”€â”€ MODALS â”€â”€
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(o=>{
  o.addEventListener('click',e=>{ if(e.target===o) o.classList.remove('open'); });
});

// â”€â”€ TOAST â”€â”€
function showToast(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toast-msg').textContent = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 3000);
}

// â”€â”€ UTILS â”€â”€
function formatDate(d) {
  return new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
}
</script>
</body>
</html>
